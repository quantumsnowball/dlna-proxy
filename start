#!/bin/bash

# before use, try to stop all existing server
if nginx -s stop 2>/dev/null; then
  echo -e "\nProxy server stopped\n"
fi

# start nginx reverse proxy server
nginx -c ~/dlna-proxy/nginx.conf
if [ $? -eq 0 ]; then
  echo -e "\nProxy server started\n"
else
  echo -e "\nFAILED: Failed to start reverse proxy server\n"
fi

# start rclone dlna server
rclone serve dlna --name DLNA --addr localhost:7879 qsc-r:DLNA

# wait for the rclone serve process to be interrupted (Ctrl+C)
wait $!

# after use, try to stop all existing server
if nginx -s stop 2>/dev/null; then
  echo -e "\nProxy server stopped\n"
fi

